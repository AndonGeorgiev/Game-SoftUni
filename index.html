<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./stayle.css">
    <title>SoftUni Game 2021</title>
</head>

<body>
    <div class="main">
        <div class="startScreen">Start Game</div>
        <div class="gameScreen hidden"></div>
    </div>


    <script>
        let gameState = {
            player: {
                speed: 5,
                x: 50,
                y: 100,
                width: 80,
                height: 100,
            },
            gameOver: false,
            keys: {},
            bug: {
                width: 50,
                height: 50,
                nextPrint: 100,
                maxTimePrint: 1500,
                speed: 4,
                maxSpeed: 7,
            },
        }

        let startScreen = document.getElementsByClassName('startScreen')[0];
        let gameScreen = document.getElementsByClassName('gameScreen')[0];

        function createBug() {
            let bugElement = document.createElement("div");
            bugElement.classList.add("bug");
            gameScreen.appendChild(bugElement);
            bugElement.style.top = (gameScreen.offsetHeight - gameState.bug.height - 40) * Math.random() + 'px';
            bugElement.style.left = (gameScreen.offsetWidth - gameState.bug.width) + 'px';
        }

        let player = document.createElement('div');
        player.className = 'player';
        gameScreen.appendChild(player);

        startScreen.addEventListener('click', startGame)


        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');

            window.requestAnimationFrame(gameLoop);

        }

        document.addEventListener('keydown', keydown)
        document.addEventListener('keyup', keyup)

        function gameLoop(time) {

            let player = document.getElementsByClassName("player")[0];

            if (gameState.keys.ArrowUp && gameState.player.y > 0) {
                gameState.player.y -= gameState.player.speed;
            }

            if (gameState.keys.ArrowDown && gameState.player.y + gameState.player.height + 3 < gameScreen.offsetHeight) {
                gameState.player.y += gameState.player.speed;
            }

            if (gameState.keys.ArrowLeft && gameState.player.x > 0) {
                gameState.player.x -= gameState.player.speed;
            }

            if (gameState.keys.ArrowRight && gameState.player.x + gameState.player.width + 3 < gameScreen.offsetWidth) {
                gameState.player.x += gameState.player.speed;
            }

            Array.from(document.getElementsByClassName('bug'))
                .forEach(x => {

                    if (hasCollision(player, x)) {
                        gameState.gameOver = true;
                    }
                    let currentPosition = parseInt(x.style.left);
                    if (currentPosition > 0) {
                        x.style.left = (currentPosition - gameState.bug.speed) + 'px';
                    } else {
                        x.remove();
                    }

                })


            if (time > gameState.bug.nextPrint) {
                createBug();
                gameState.bug.nextPrint = time + (gameState.bug.maxTimePrint * Math.random() * 1.1);
            }



            player.style.top = gameState.player.y + 'px';
            player.style.left = gameState.player.x + 'px';
            gameState.bug.speed += 0.001



            if (!gameState.gameOver) {
                window.requestAnimationFrame(gameLoop)
            } else {
                alert('Game Over');
            }
        }


        function keydown(e) {
            console.log(e.code);
            gameState.keys[e.code] = true;
        }

        function keyup(e) {
            gameState.keys[e.code] = false;
        }

        function hasCollision(elementOne, elementTwo) {
            let first = elementOne.getBoundingClientRect();
            let second = elementTwo.getBoundingClientRect();

            return !(first.top > second.bottom || first.bottom < second.top || first.left > second.right || first.right < second.left);
        }
    </script>
</body>s

</html>